Important bug fix in decoding functions